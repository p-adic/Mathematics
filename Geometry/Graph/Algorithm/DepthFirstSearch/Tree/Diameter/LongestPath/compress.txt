#ifdef DEBUG
  #include "c:/Users/user/Documents/Programming/Mathematics/Geometry/Graph/Algorithm/DepthFirstSearch/Tree/Diameter/LongestPath/a_Body.hpp"
#else
// êÊÇ…DepthFirstSearchOnTreeÇì\ÇÈÅB

TE <TY DFST,TY F>ret_t<F> RootingDP(DFST& dfst,F f){US U = ret_t<F>;ST_AS(is_invocable_r_v<U,F,VE<U>,int>);CRI V = dfst.SZ();VE<VE<U>> children_value(V);U temp;for(int n = 0;n < V;n++){CRI i = dfst.NodeNumber(n,true);CRI j = dfst.Parent(i);temp = f(MO(children_value[i]),i);if(j != -1){children_value[j].push_back(MO(temp));}}RE temp;}TE <TY DFST,TY MONOID,TY F,TY G>VE<inner_t<MONOID>> RerootingDP(DFST& dfst,MONOID M,F f,G g){US U = inner_t<MONOID>;ST_AS(is_invocable_r_v<U,F,U,int> && is_invocable_r_v<U,G,U,bool,int,int>);CRI V = dfst.SZ();CO U& e = M.Unit();VE<VE<U>> children_value(V);VE<VE<U>> l_sum(V);VE<VE<U>> r_sum(V);for(int i = 0;i < V;i++){children_value[i].resize(dfst.Children(i).SZ());}for(int n = 0;n < V;n++){CRI i = dfst.NodeNumber(n,true);CO int SZ_i = children_value[i].SZ();U temp = e;l_sum[i].reserve(SZ_i + 1);l_sum[i].push_back(temp);for(int m = 0;m < SZ_i;m++){l_sum[i].push_back(temp = M.Product(temp,g(children_value[i][m],true,i,dfst.Children(i)[m])));}CRI j = dfst.Parent(i);if(j != -1){children_value[j][dfst.ChildrenNumber(i)]= f(temp,i);}temp = e;r_sum[i].resize(SZ_i);for(int m = 1;m <= SZ_i;m++){r_sum[i][SZ_i - m]= temp;temp = M.Product(g(children_value[i][SZ_i - m],true,i,dfst.Children(i)[SZ_i - m]),temp);}}for(int n = 1;n < V;n++){CRI i = dfst.NodeNumber(n);CRI j = dfst.Parent(i);CRI k = dfst.ChildrenNumber(i);CO int SZ_i = r_sum[i].SZ();CO U rest_i = g(f(M.Product(l_sum[j][k],r_sum[j][k]),j),false,i,j);for(int m = 0;m <= SZ_i;m++){l_sum[i][m]= M.Product(rest_i,l_sum[i][m]);}}VE<U> AN(V);for(int i = 0;i < V;i++){AN[i]= f(l_sum[i].back(),i);}RE AN;}

TE <TY U>CL VirtualMeetSemilattice:VI PU VirtualMonoid<U>{PU:IN U Meet(U u0,CO U& u1);};TE <TY U>CL MinSemilattice:VI PU VirtualMeetSemilattice<U>,PU PointedSet<U>{PU:IN MinSemilattice(U infty_U);IN U Product(U u0,CO U& u1);};TE <TY U>CL MaxSemilattice:VI PU VirtualMeetSemilattice<U>,PU PointedSet<U>{PU:IN MaxSemilattice(U zero_U);IN U Product(U u0,CO U& u1);};
TE <TY U> IN U VirtualMeetSemilattice<U>::Meet(U u0,CO U& u1){RE TH->Product(MO(u0),u1);}TE <TY U> IN MinSemilattice<U>::MinSemilattice(U infty_U):PointedSet<U>(MO(infty_U)){}TE <TY U> IN MaxSemilattice<U>::MaxSemilattice(U zero_U):PointedSet<U>(MO(zero_U)){}TE <TY U> IN U MinSemilattice<U>::Product(U u0,CO U& u1){RE u0 < u1?MO(u0):u1;}TE <TY U> IN U MaxSemilattice<U>::Product(U u0,CO U& u1){RE u1 < u0?MO(u0):u1;}

TE <TY U>CL AscendingChainSemilattice:VI PU VirtualMeetSemilattice<VE<U>>,PU PointedSet<VE<U>>{PU:int m_LE;IN AscendingChainSemilattice(int LE = 2);IN VE<U> Product(VE<U> a0,CO VE<U>& a1);};TE <TY U>CL DescendingChainSemilattice:VI PU VirtualMeetSemilattice<VE<U>>,PU PointedSet<VE<U>>{PU:int m_LE;IN DescendingChainSemilattice(int LE = 2);IN VE<U> Product(VE<U> a0,CO VE<U>& a1);};
TE <TY U> IN AscendingChainSemilattice<U>::AscendingChainSemilattice(int LE):m_LE(MO(LE)){}TE <TY U> IN DescendingChainSemilattice<U>::DescendingChainSemilattice(int LE):m_LE(MO(LE)){}TE <TY U> IN VE<U> AscendingChainSemilattice<U>::Product(VE<U> a0,CO VE<U>& a1){CO int SZ0 = a0.SZ();for(auto& u:a1){a0.push_back(u);}auto BE = a0.BE();inplace_merge(BE,BE + SZ0,a0.EN());if(SZ0 + int(a1.SZ())> m_LE){a0.resize(m_LE);}RE MO(a0);}TE <TY U> IN VE<U> DescendingChainSemilattice<U>::Product(VE<U> a0,CO VE<U>& a1){ST auto comp =[](CO U& u0,CO U& u1){RE u1 < u0;};CO int SZ0 = a0.SZ();for(auto& u:a1){a0.push_back(u);}auto BE = a0.BE();inplace_merge(BE,BE + SZ0,a0.EN(),comp);if(SZ0 + int(a1.SZ())> m_LE){a0.resize(m_LE);}RE MO(a0);}

TE <TY DFST> IN VE<VE<int>> LongestPath(DFST& dfst,CRI K,CO bool& distinct_branch){RE RerootingDP(dfst,DescendingChainSemilattice<int>{K},[&](VE<int> u,CRI i){RE MO(++u);},[&](CO VE<int>& u,CO bool& is_child,CRI k,CRI j){RE u.empty()?VE{0}:distinct_branch?VE{u[0]}:u;});}
#endif

