TE <TY T>US TT = VE<VE<T> >;TE <UI Y,UI X,TY T>CL MA{PU:TT<T> m_M;IN MA(CO T& t = T()) NE;IN MA(CRI t) NE;TE <TY... Args> IN MA(CO T& t0,CO T& t1,CO Args&... args) NE;TE <TY... Args> IN MA(T&& t0,T&& t1,Args&&... args) NE;IN MA(CO MA<Y,X,T>& mat) NE;IN MA(MA<Y,X,T>&& mat) NE;TE <TY... Args> IN MA(CO TT<T>& M) NE;TE <TY... Args> IN MA(TT<T>&& M) NE;IN MA<Y,X,T>& OP=(CO MA<Y,X,T>& mat) NE;IN MA<Y,X,T>& OP=(MA<Y,X,T>&& mat) NE;MA<Y,X,T>& OP+=(CO MA<Y,X,T>& mat);MA<Y,X,T>& OP-=(CO MA<Y,X,T>& mat);MA<Y,X,T>& OP*=(CO T& scalar) NE;IN MA<Y,X,T>& OP*=(CO MA<X,X,T>& mat) NE;MA<Y,X,T>& OP%=(CO T& scalar) NE;IN TT<T>& RefTable() NE;IN CO TT<T>& GetTable() CO NE;ST IN CO MA<Y,X,T>& Zero() NE;ST IN CO MA<Y,X,T>& Unit() NE;ST MA<Y,X,T> Scalar(CO T& t) NE;ST IN VO COructTable(TT<T>& M,VE<T>& vec) NE;TE <TY... Args> ST VO COructTable(TT<T>& M,VE<T>& vec,CO T& t,CO Args&... args) NE;TE <TY... Args> ST VO COructTable(TT<T>& M,VE<T>& vec,T&& t,Args&&... args) NE;ST MA<Y,X,T> Zero_Body() NE;};TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP==(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2) NE;TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP!=(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2) NE;TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP+(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2);TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP-(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2);TE <UI Y,UI X,UI Z,TY T>MA<Y,Z,T> OP*(CO MA<Y,X,T>& mat1,CO MA<X,Z,T>& mat2);TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP*(CO MA<Y,X,T>& mat,CO T& scalar);TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP*(CO T& scalar,CO MA<Y,X,T>& mat);TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP%(CO MA<Y,X,T>& mat,CO T& scalar);TE <UI Y,UI X,TY T>MA<X,Y,T> Transpose(CO MA<Y,X,T>& mat);TE <UI X,TY T>T Trace(CO MA<X,X,T>& mat);
TE <UI Y,UI X,TY T> IN MA<Y,X,T>::MA(CO T& t) NE:m_M(){OP=(Scalar(t));}TE <UI Y,UI X,TY T> IN MA<Y,X,T>::MA(CRI t) NE:MA(T(t)){}TE <UI Y,UI X,TY T> TE <TY... Args> IN MA<Y,X,T>::MA(CO T& t0,CO T& t1,CO Args&... args) NE:m_M(){VE<T> vec{};COructTable(m_M,vec,t0,t1,args...);}TE <UI Y,UI X,TY T> TE <TY... Args> IN MA<Y,X,T>::MA(T&& t0,T&& t1,Args&&... args) NE:m_M(){VE<T> vec{};COructTable(m_M,vec,MO(t0),MO(t1),MO(args)...);}TE <UI Y,UI X,TY T> IN MA<Y,X,T>::MA(CO MA<Y,X,T>& mat) NE:m_M(mat.m_M){}TE <UI Y,UI X,TY T> IN MA<Y,X,T>::MA(MA<Y,X,T>&& mat) NE:m_M(MO(mat.m_M)){}TE <UI Y,UI X,TY T> TE <TY... Args> IN MA<Y,X,T>::MA(CO TT<T>& M) NE:m_M(M){}TE <UI Y,UI X,TY T> TE <TY... Args> IN MA<Y,X,T>::MA(TT<T>&& M) NE:m_M(MO(M)){}TE <UI Y,UI X,TY T> IN MA<Y,X,T>& MA<Y,X,T>::OP=(CO MA<Y,X,T>& mat) NE{m_M = mat.m_M;RE *TH;}TE <UI Y,UI X,TY T> IN MA<Y,X,T>& MA<Y,X,T>::OP=(MA<Y,X,T>&& mat) NE{m_M = MO(mat.m_M);RE *TH;}TE <UI Y,UI X,TY T>MA<Y,X,T>& MA<Y,X,T>::OP+=(CO MA<Y,X,T>& mat){auto I1y = m_M.BE(),EN1y = m_M.EN();auto I2y = mat.m_M.BE();WH(I1y != EN1y){auto I1xy = I1y->BE(),EN1xy = I1y->EN();auto I2xy = I2y->BE();WH(I1xy != EN1xy){*I1xy += *I2xy;I1xy++;I2xy++;}I1y++;I2y++;}RE *TH;}TE <UI Y,UI X,TY T>MA<Y,X,T>& MA<Y,X,T>::OP-=(CO MA<Y,X,T>& mat){auto I1y = m_M.BE(),EN1y = m_M.EN();auto I2y = mat.m_M.BE();WH(I1y != EN1y){auto I1xy = I1y->BE(),EN1xy = I1y->EN();auto I2xy = I2y->BE();WH(I1xy != EN1xy){*I1xy -= *I2xy;I1xy++;I2xy++;}I1y++;I2y++;}RE *TH;}TE <UI Y,UI X,TY T> MA<Y,X,T>& MA<Y,X,T>::OP*=(CO T& scalar) NE{for(auto Iy = m_M.BE(),ENy = m_M.EN();Iy != ENy;Iy++){for(auto Ixy = Iy->BE(),ENxy = Iy->EN();Ixy != ENxy;Ixy++){*Ixy *= scalar;}}RE *TH;}TE <UI Y,UI X,TY T> IN MA<Y,X,T>& MA<Y,X,T>::OP*=(CO MA<X,X,T>& mat) NE{RE OP=(MO(*TH * mat));}TE <UI Y,UI X,TY T> MA<Y,X,T>& MA<Y,X,T>::OP%=(CO T& scalar) NE{for(auto Iy = m_M.BE(),ENy = m_M.EN();Iy != ENy;Iy++){for(auto Ixy = Iy->BE(),ENxy = Iy->EN();Ixy != ENxy;Ixy++){*Ixy %= scalar;}}RE *TH;}TE <UI Y,UI X,TY T> IN TT<T>& MA<Y,X,T>::RefTable() NE{RE m_M;}TE <UI Y,UI X,TY T> IN CO TT<T>& MA<Y,X,T>::GetTable() CO NE{RE m_M;}TE <UI Y,UI X,TY T> IN CO MA<Y,X,T>& MA<Y,X,T>::Zero() NE{ST CO MA<Y,X,T> zero = MO(Zero_Body());RE zero;}TE <UI Y,UI X,TY T> IN CO MA<Y,X,T>& MA<Y,X,T>::Unit() NE{ST CO MA<Y,X,T> unit = MO(Scalar(T(1)));RE unit;}TE <UI Y,UI X,TY T>MA<Y,X,T> MA<Y,X,T>::Zero_Body() NE{VE<T> vec(X);TT<T> M(Y,vec);RE MA<Y,X,T>(MO(M));}TE <UI Y,UI X,TY T>MA<Y,X,T> MA<Y,X,T>::Scalar(CO T& t) NE{MA<Y,X,T> M{MO(Zero_Body())};CE CO UI minXY = Y < X?Y:X;for(UI y = 0;y < minXY;y++){M.m_M[y][y] = t;}RE M;}TE <UI Y,UI X,TY T> IN VO MA<Y,X,T>::COructTable(TT<T>& M,VE<T>& vec) NE{M.push_back(MO(vec));}TE <UI Y,UI X,TY T> TE <TY... Args> VO MA<Y,X,T>::COructTable(TT<T>& M,VE<T>& vec,CO T& t,CO Args&... args) NE{vec.push_back(t);if(vec.SZ() == X){VE<T> v{};v.swap(vec);COructTable(M,v);}if(M.SZ() < Y){COructTable(M,vec,args...);}RE;}TE <UI Y,UI X,TY T> TE <TY... Args> VO MA<Y,X,T>::COructTable(TT<T>& M,VE<T>& vec,T&& t,Args&&... args) NE{vec.push_back(MO(t));if(vec.SZ() == X){VE<T> v{};v.swap(vec);COructTable(M,v);}if(M.SZ() < Y){COructTable(M,vec,MO(args)...);}RE;}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP==(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2) NE{RE mat1.GetTable() == mat2.GetTable();}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP!=(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2) NE{RE !(mat1 == mat2);}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP+(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2){RE MA<Y,X,T>(mat1) += mat2;}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP-(CO MA<Y,X,T>& mat1,CO MA<Y,X,T>& mat2){RE MA<Y,X,T>(mat1) -= mat2;}TE <UI Y,UI X,UI Z,TY T> IN MA<Y,Z,T> OP*(CO MA<Y,X,T>& mat1,CO MA<X,Z,T>& mat2){CO TT<T>& M1 = mat1.GetTable();CO TT<T>& M2 = mat2.GetTable();TT<T> M_prod{};auto BE2x = M2.BE();for(auto I1y = M1.BE(),EN1y = M1.EN();I1y != EN1y;I1y++){VE<T> vec{};auto BE1yx = I1y->BE(),EN1yx = I1y->EN();for(UI z = 0;z < Z;z++){auto I1yx = BE1yx;auto I2x = BE2x;T inner_product{};WH(I1yx != EN1yx){inner_product += (*I1yx) * (*I2x)[z];I1yx++;I2x++;}vec.push_back(inner_product);}M_prod.push_back(MO(vec));}RE MA<Y,Z,T>(MO(M_prod));}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP*(CO MA<Y,X,T>& mat,CO T& scalar){RE MA<Y,X,T>(mat) *= scalar;}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP*(CO T& scalar,CO MA<Y,X,T>& mat){RE mat * scalar;}TE <UI Y,UI X,TY T> IN MA<Y,X,T> OP%(CO MA<Y,X,T>& mat,CO T& scalar){RE MA<Y,X,T>(mat) %= scalar;}TE <UI Y,UI X,TY T>MA<X,Y,T> Transpose(CO MA<Y,X,T>& mat){CO TT<T>& M = mat.GetTable();TT<T> M_t{};auto BEy = M.BE();for(auto I1x = BEy->BE(),EN1x = BEy->EN();I1x != EN1x;I1x++){M_t.push_back(VE<T>());}for(auto Iy = BEy,ENy = M.EN();Iy != ENy;Iy++){auto Iyx = Iy->BE(),ENyx = Iy->EN();auto I_ty = M_t.BE();WH(Iyx != ENyx){I_ty->push_back(*Iyx);Iyx++;I_ty++;}}RE MA<X,Y,T>(M_t);}TE <UI X,TY T>T Trace(CO MA<X,X,T>& mat){int i = 0;T AN =0;CO TT<T>& M = mat.GetTable();for(auto Iy = M.BE(),ENy = M.EN();Iy != ENy;Iy++){AN += (*Iy)[i];i++;}RE AN;}
