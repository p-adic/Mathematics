TE <TY U>CL BIT{PU:int m_SZ;VE<U> m_fenwick;int m_PW;IN BIT(CRI SZ = 0);BIT(CO VE<U>& a);IN VO Set(CRI i,CO U& u);IN VO Set(CO VE<U>& a);IN VO Initialise(CRI SZ = 0);IN BIT<U>& OP+=(CO VE<U>& a);VO Add(CRI i,CO U& u);IN CRI SZ()CO NE;IN U OP[](CRI i)CO;IN U Get(CRI i)CO;IN CO U& LSBSegmentSum(CRI j)CO;U InitialSegmentSum(CRI i_final)CO;IN U IntervalSum(CRI i_start,CRI i_final)CO;int BinarySearch(CO U& u)CO;IN int BinarySearch(CRI i_start,CO U& u)CO;};
TE <TY U> IN BIT<U>::BIT(CRI SZ):m_SZ(SZ),m_fenwick(m_SZ + 1),m_PW(1){ST_AS(! is_same<U,int>::value);WH(m_PW < m_SZ){m_PW <<= 1;}}TE <TY U>BIT<U>::BIT(CO VE<U>& a):BIT(a.SZ()){for(int j = 1;j <= m_SZ;j++){U& fenwick_j = m_fenwick[j];int i = j - 1;fenwick_j = a[i];int i_lim = j -(j & -j);WH(i > i_lim){fenwick_j += m_fenwick[i];i -=(i & -i);}}}TE <TY U> IN VO BIT<U>::Set(CRI i,CO U& u){Add(i,u - IntervalSum(i,i));}TE <TY U> IN VO BIT<U>::Set(CO VE<U>& a){*TH = BIT<U>{a};}TE <TY U> IN VO BIT<U>::Initialise(CRI SZ){*TH = BIT<U>(SZ);}TE <TY U> IN BIT<U>& BIT<U>::OP+=(CO VE<U>& a){BIT<U> a_copy{a};AS(m_SZ == a.m_SZ);for(int j = 1;j <= m_SZ;j++){m_fenwick[j]+= a.m_fenwick[j];}RE *TH;}TE <TY U>VO BIT<U>::Add(CRI i,CO U& u){AS(0 <= i && i < m_SZ);int j = i + 1;WH(j <= m_SZ){m_fenwick[j]+= u;j +=(j & -j);}RE;}TE <TY U> IN CRI BIT<U>::SZ()CO NE{RE m_SZ;}TE <TY U> IN U BIT<U>::OP[](CRI i)CO{AS(0 <= i && i < m_SZ);RE IntervalSum(i,i);}TE <TY U> IN U BIT<U>::Get(CRI i)CO{RE OP[](i);}TE <TY U> IN CO U& BIT<U>::LSBSegmentSum(CRI j)CO{AS(0 < j && j <= m_SZ);RE m_fenwick[j];}TE <TY U>U BIT<U>::InitialSegmentSum(CRI i_final)CO{U sum = 0;int j =(i_final < m_SZ?i_final:m_SZ - 1)+ 1;WH(j > 0){sum += m_fenwick[j];j -= j & -j;}RE sum;}TE <TY U> IN U BIT<U>::IntervalSum(CRI i_start,CRI i_final)CO{RE InitialSegmentSum(i_final)- InitialSegmentSum(i_start - 1);}TE <TY U>int BIT<U>::BinarySearch(CO U& u)CO{int PW = m_PW;int j = 0;U sum{};U sum_next{};WH(PW > 0){int j_next = j | PW;if(j_next < m_SZ){sum_next += m_fenwick[j_next];if(sum_next < u){sum = sum_next;j = j_next;}else{sum_next = sum;}}PW >>= 1;}RE j;}TE <TY U> IN int BIT<U>::BinarySearch(CRI i_start,CO U& u)CO{RE max(i_start,BinarySearch(InitialSegmentSum(i_start - 1)+ u));}
